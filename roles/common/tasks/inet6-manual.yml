---
- name: Set inet6 auto to manual
  ansible.posix.sysctl:
    name: "{{ item.name }}"
    value: "{{ item.value }}"
    sysctl_set: true
  with_items:
    - { name: net.ipv6.conf.all.autoconf, value: "0" }
    - { name: net.ipv6.conf.default.autoconf, value: "0" }
  become: true

- name: Ensure the interfaces file is updated, commenting out any IPv6 line
  ansible.builtin.replace:
    path: /etc/network/interfaces
    regexp: (^iface.*inet6)
    replace: "# \\1"
