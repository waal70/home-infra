Configure your device to a certain boot order:
* Primary HD first
* USB / Removable media seconds
* NIC / PXE third

This way, on a valid install, you will always boot from the internal drive
If this drive fails or there is another issue, it will look for a USB image, then do a PXE boot

How to force PXE boot. WARNING: This will obliterate the partitions on your HDD!~
This is assuming you have "classical" boot, i.e. MBR-based (also named BIOS mode or Legacy mode)
The MBR stores the bootloading instructions in the first few bits of the hard disk. Zeroing them will therefore be the trick:

dd if=/dev/zero of=/dev/sda bs=446 count=1

Now, your system will find the /dev/sda is no longer appropriate to start from, and will move down the boot prio list!


On your designated TFTP-server:
Download netboot.tar.gz from: wget https://deb.debian.org/debian/dists/bookworm/main/installer-amd64/current/images/netboot/netboot.tar.gz

Place this downloaded file in your tftp folder - the one that serves boot files (e.g. /srv/tftp)
The folder is configurable with your tftp server. For Debian, choose tftpd-hpa (unmask, enable, restart). Usually, this has its defaults ok (/etc/default/tftpd-hpa)

tar -xvf netboot.tar.gz
rm netboot.tar.gz

Now manipulate initrd.gz with a preseed.cfg file:

gunzip initrd.gz
echo preseed.cfg | cpio -H newc -o -A -F initrd
gzip initrd

in debian-installer/amd64/pxelinux.cfg is the file "default"
Edit to reflect a timeout value (non-zero) to autoboot (e.g. 50 for 5 seconds)
Add a stanza to preselect "install" as default by adding to the end of this file:
default install

in debian-installer/amd64/boot-screens/txt.cfg
add to the append-line:
"auto=true priority=critical interface=auto"

Now, change your DHCP server to give network boot options (IP and filename). For IP, select the designated server. As filename, put /pxelinux.0
Enjoy your network boot!


Should we create a home directory? In that case, specify -m
1) Use late_command to add user 'ansible' (use mkpasswd -m sha-512 to generate password):
2) Then, use another late_command to pass it the appropriate public key:
Resulting lines are here:

d-i preseed/late_command string in-target useradd -m ansible -p $6$6E8C5G1ewqDviRc1$I4XcH5Y9HdhdVjQDnT9AW6aErJv0wTzukTNps0lMe0VbH.Tk4QyU9ntnipEL2zpf0H0ne9KkvN1nKdddDHEfg.
d-i preseed/late_command string in-target mkdir -p /home/ansible/.ssh; \
in-target /bin/sh -c "echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCy/RzRMaaeY2w6xtOyETFzlu3FjXHpsD6WEpo3dBXXi2FpN79RQz/ybJF3rJ1CPR0S8NXPbzWXFOf6o9bOETQDKxAQwuEa9K08o4d3aa62QheeBJWvYgOxO827mYS19u6RmsEYWDbtEqudMdDg2rKEBT/HFTf4cvphpvJSCGAkQNSjKCTx0UTqZmKxX8idDemLqxU3VT9ebmfonKQ90Xn1tq/qkZRDMf8yeL90kyHpMLZJhDT91WQvVFuA+eYCXZtIhhNMl71CfizwKHtrvvs59ej3GB29LZClaeTuSO0dBSUvK+cXNFD7JBbkZlz6MFwsl+xpPGfGHqTMIqP/1+rFzwIxJ4KfcEHy7kqH0z101oWqTHJ4QA3I7jMlgZv5kUYNji1CzVGhMM6JK1isKjiXrzQgRCqbEVSBkh0iNDMIs8jEvwOtJAb1UVDopL4gmuTEoPvhbivZxbaUC2S5EuKXZ3N30kKtUiH22DXZ58OGtFavsTyxReWkSRVB3Sm/B9U= ansible' >> /home/ansible/.ssh/authorized_keys"; \
in-target chown -R ansible:user /home/ansible/.ssh/; \
in-target chmod 600 /home/ansible/.ssh/authorized_keys; \
in-target chmod 700 /home/ansible/.ssh/
